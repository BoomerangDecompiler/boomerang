macro(ADD_LOADER name)
    set(target_name "${name}BinaryFile")
    add_library(${target_name} MODULE  SymTab.cpp ${ARGN} )
    if(WIN32)
            target_link_libraries(${target_name} BinaryFile)
            set_target_properties(${target_name} PROPERTIES LIBRARY_OUTPUT_DIRECTORY_DEBUG "${PROJECT_SOURCE_DIR}/out/lib")
    endif()
    set_target_properties(${target_name} PROPERTIES LIBRARY_OUTPUT_DIRECTORY "${PROJECT_SOURCE_DIR}/out/lib")
endmacro()
ADD_LIBRARY(BinaryFile       SHARED  SymTab.cpp  BinaryFile.cpp)
ADD_LOADER(Elf      ElfBinaryFile.cpp)
ADD_LOADER(Win32    Win32BinaryFile.cpp microX86dis.c)
IF(WIN32)
    target_link_libraries(Win32BinaryFile Dbghelp.lib util)
ENDIF()
ADD_LOADER(Exe      ExeBinaryFile.cpp)
ADD_LOADER(HpSom    HpSomBinaryFile.cpp)
ADD_LOADER(Palm     PalmBinaryFile.cpp)
ADD_LOADER(DOS4GW   DOS4GWBinaryFile.cpp microX86dis.c)

ADDCFLAG(MachOBinaryFile.cpp "-I${CMAKE_CURRENT_SOURCE_DIR}")
ADD_LOADER(MachO MachOBinaryFile.cpp)

ADD_EXECUTABLE(bffDump bffDump.cpp BinaryFileFactory.cpp)
TARGET_LINK_LIBRARIES(bffDump ${DL_LIBS})
TARGET_LINK_LIBRARIES(bffDump BinaryFile)

IF(CPPUNIT_FOUND)
    ADD_EXECUTABLE(testLoader testLoader.cpp LoaderTest.cpp BinaryFileFactory.cpp microX86dis.c SymTab.cpp)
    TARGET_LINK_LIBRARIES(testLoader ${CPPUNIT_LIBS})
    TARGET_LINK_LIBRARIES(testLoader ${DL_LIBS})
    TARGET_LINK_LIBRARIES(testLoader BinaryFile)
ENDIF()
